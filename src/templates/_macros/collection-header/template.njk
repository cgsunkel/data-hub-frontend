{% from '../form.njk' import Form %}

{% set buildQuery = buildQuery or props.buildQuery %}
{% set totalCost = props.summary.total_subtotal_cost %}
{% set count = props.count | default('0') %}
{% set countLabel = props.countLabel | default('result') %}
{% set actionButtons = props.actionButtons | default([]) | castArray %}

<header class="c-collection__header">

  <div class="c-collection__header-row">
    <div class="c-collection__header-intro">
      <span class="c-collection__result-count">{{ count | formatNumber }}</span>
      {{ countLabel | pluralise(count) }}
      {% if props.highlightTerm or selectedFilters | length %}
        matching
        {% if props.highlightTerm %}
          <span class="u-highlight">{{ props.highlightTerm }}</span>
        {% endif %}
      {% endif %}
    </div>

    {% if actionButtons.length %}
      <div class="c-collection__header-actions">
        {% for actionButton in actionButtons %}
          <a class="button" href="{{ actionButton.url }}">{{ actionButton.label }}</a>
        {% endfor %}
      </div>
    {% endif %}

    {% if props.selectedFilters | length %}
      <div class="c-collection__summary">
        {% for name, filter in props.selectedFilters %}
          <span class="c-collection__filter-tag">
            <span class="c-collection__filter-label">{{ filter.label }}</span>
            <span class="c-collection__filter-value">
              {%- if 'date' in name -%}
                {{ filter.valueLabel | formatDate }}
              {%- else -%}
                {{ filter.valueLabel }}
              {%- endif -%}
            </span>
          </span>
        {% endfor %}

        <a
          href="?{{ buildQuery({}, { custom: true, sortby: props.sortForm.children[0].value }) }}"
          class="c-collection__filter-remove-all js-xhr js-ClearInputs"
          data-target-selector=".c-collection-filters"
          aria-label="Reset filter results"
        >
          Remove all filters
        </a>
      </div>
    {% endif %}

    {# TODO this needs to be an array of items and not explicitly referencing a field #}
    {% if props.summary %}
      <div class="c-collection__summary">
        <span class="c-collection__filter-tag">
          Total value:
          <span class="c-collection__filter-value">
            Â£{{ (totalCost / 100) | formatNumber }}
          </span>
        </span>
      </div>
    {% endif %}

  </div>

  {% if (count > 1 and props.sortForm) or props.exportAction.enabled %}
    <div class="c-collection__header-row">
      {{ Form(props.sortForm) if props.sortForm }}

      {% if props.exportAction.enabled %}
        <span class="c-collection__header-actions">
          {% if not props.exportAction.invalidNumberOfItems(count, props.exportAction.maxItems) %}
            <a class="button button--secondary" download href="{{ props.exportAction.url }}">Download</a>
          {% endif %}
        </span>
      {% endif %}
    </div>
  {% endif %}

  {% if props.exportAction.enabled %}
    <div class="c-collection__header-row">
      {{ props.exportAction.buildMessage(count) }}
    </div>
  {% endif %}

</header>
