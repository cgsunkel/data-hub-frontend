{% extends "_layouts/template.njk" %}

{% block local_header %}
  {% call LocalHeader({ modifier: 'dark-banner' }) %}
    {{ EntitySearchForm({
      inputName: 'term',
      modifier: 'global',
      action: '/search/companies',
      inputLabel: 'Search for company, contact, event, investment project or OMIS order'
    }) }}
  {% endcall %}
{% endblock %}

{% block body_main_content %}
  <div class="grid-row dashboard">
    <div class="govuk-grid-column-two-thirds">
    {% if interactionsPermitted %}
        <div class="dashboard-section">
          <h2 class="dashboard-section-title">My latest 5 interactions</h2>
          <a href="/interactions" class="dashboard-section__link">See all interactions</a>
          {% if interactions.length %}
            {% set interactionData = [] %}
            {% for interaction in interactions.slice(0, 5) %}
              {% set interactionData = (interactionData.push({interaction:  interaction.subject, company: interaction.company.name, outboundURL: '/interactions/' + interaction.id +''}), interactionData) %}
            {% endfor %}

            {% component 'data-table', {
              variant: 'slim',
              cellClasses: 'govuk-grid-column-one-half',
              data: interactionData
            } %}

          {% else %}
            <p>No interactions have been added.</p>
          {% endif %}
        </div>
    {% endif %}

      <div class="dashboard-section">
        <h2 class="dashboard-section-title">My latest contacts</h2>
        <a href="/contacts" class="dashboard-section__link">See all contacts</a>
        {% if contacts.length %}

          {% set contactData = [] %}
          {% for contact in contacts.slice(0, 5) %}
            {% set contactData = (contactData.push({name: contact.first_name + ' ' + contact.last_name, company: contact.company.name, outboundURL: '/contacts/' + contact.id +''}), contactData) %}
          {% endfor %}

          {% component 'data-table', {
            variant: 'slim',
            cellClasses: 'govuk-grid-column-one-half',
            data: contactData
          } %}
        {% else %}
          <p>No contacts have been added.</p>
        {% endif %}
      </div>
    </div>

    <div class="govuk-grid-column-one-third">
      {% component 'info-feed', {
        heading: 'Data Hub Updates',
        subHeading: 'Announcements & updates from the Data Hub team',
        feedLimit: 3,
        dataFeed: articleFeed,
        outboundLinkURL: '#',
        outboundLinkText: 'View all updates'
      } %}
    </div>

  </div>

{% endblock %}
